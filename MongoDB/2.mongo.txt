// Пошук всіх вчителів
db.teacher.find()

// Пошук всіх студентів
db.students.find()

// Агрегація: групування вчителів за предметами
db.teacher.aggregate([
    {
        $group: {
            _id: '$lesson'
        }
    }
])

// Агрегація: підрахунок статистики по предметах
db.teacher.aggregate([
    {
        $group: {
            _id: '$lesson',
            countOfLessons: {$sum: 1},
            min: {$min: '$payment'},
            max: {$max: '$payment'},
            avg: {$avg: '$payment'},
            sum: {$sum: '$payment'}
        }
    }
])

// Агрегація: підрахунок кількості вчителів за предметами та сортування за кількістю
db.teacher.aggregate([
    {
        $group: {
            _id: '$lesson',
            count: {
                $sum: 1
            }
        }
    },
    {
        $sort: {
            count: -1
        }
    },
    {
        $project: {
            _id: 0,
            lesson: '$_id',
            count: 1
        }
    }
])

// Агрегація: використання $match, $lookup, сортування, забирання та обмеження результатів
db.teacher.aggregate([
    {
        $match: {
            class_curator: {$gt: 5}
        }
    },
    {
        $lookup: {
            from: 'students',
            localField: 'class_curator',
            foreignField: 'class',
            as: 'myStudents'
        }
    },
    {
        $sort: {class_curator: -1}
    },
    {
        $skip: 3
    },
    {
        $limit: 2
    }
])

// Агрегація: використання $lookup та $match для фільтрації студентів за ім'ям та професією батьків
db.teacher.aggregate([
    {
        $lookup: {
            from: 'students',
            localField: 'class_curator',
            foreignField: 'class',
            as: 'myStudents'
        }
    },
    {
        $match: {
            'myStudents.name': 'Ivan'
        },
    },
    {
        $match: {
            'myStudents.parents.profession': 'doctor'
        }
    }
])

// Агрегація: розгортання полів та фільтрація за професією батьків
db.teacher.aggregate([
    {
        $lookup: {
            from: 'students',
            localField: 'class_curator',
            foreignField: 'class',
            as: 'myStudents'
        }
    },
    {
        $unwind: '$myStudents'
    },
    {
        $unwind: '$myStudents.parents'
    },
    {
        $match: {
            'myStudents.parents.profession': 'doctor'
        }
    },
    {
        $count: 'count'
    }
])

// Агрегація: додавання поля nameLength та фільтрація за довжиною імен студентів
db.students.aggregate([
    {
        $addFields: {
            nameLength: {$strLenCP: '$name'}
        }
    },
    {
        $match: {
            nameLength: {$eq: 4}
        }
    },
    {
        $project: {
            nameLength: 0,
        }
    },
])

// Пошук студентів з іменами довжиною більше 4
db.students.find({$expr: {$gt: [{$strLenCP: '$name'}, 4]}})
